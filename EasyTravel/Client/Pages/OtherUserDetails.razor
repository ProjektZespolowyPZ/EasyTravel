@page "/users/{Id:int}"
@using System.Text.Json
@using System.Text
@using System.Net.Http.Headers

@inject NavigationManager NavigationManager

@inject HttpClient Http

<div class="page">
    <AuthorizeView>
        <Authorized Context="Auth">
            @if (user == null)
            {
                <p>Wczytywanie...</p>
            }
            else
            {
                <div class="panel-full">
                    <div class="top">
                        <img src="background.png" class="background-img" alt="background">
                       @if (user.ProfilePicture != "")
                        {
                            <div>
                                <img class="avatar-img" src="@user.ProfilePicture"/>
                            </div>                  
                        }
                        else{
                            <div>
                                <img class="avatar-img" src="person.icon.png" />
                            </div>
                        }
                        <br>
                        <br>
                        <br>

                        <h5>@user.Name @user.Surname</h5>      
                        <div class="contacts">
                            <h6>Kontakt:</h6>
                            <label>@user.Email</label><br>
                            <label>@user.PhoneNumber</label>

                        </div>
              
                        <h5 style="padding: 10px;">Wycieczki</h5>
                        <br>
                    </div> 

                        @foreach (var item in user.UserTours)
                        {

                            <div class="background" @onclick="() => GoToDetails(item.Id)">
                                <div class="centered">@item.TourName</div>
                                @if (item.MainPhoto != "")
                                {

                                    <img src="@item.MainPhoto" style="width:100%;height:100%; background-position:center; background-size:cover;" />

                                }
                            </div>
                        }
                    </div>
                
                    
            }
        </Authorized>
        <NotAuthorized>
            <p>Nie można wyświetlić strony niezalogowanym użytkownikom</p>
        </NotAuthorized>
    </AuthorizeView>
</div>
@code {
    [Parameter]
    public int Id { get; set; }
    private UserInformationVm user;


    protected override async Task OnInitializedAsync()
    {
        user = await Http.GetFromJsonAsync<UserInformationVm>($"api/users/GetOtherUserInformation/{Id}");
        user.UserTours.Reverse();
    }

    public void GoToDetails(int id)
    {
        NavigationManager.NavigateTo($"/tours/{id}");
    }
}

