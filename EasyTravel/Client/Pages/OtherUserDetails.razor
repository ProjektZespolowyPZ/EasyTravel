@page "/users/{Id:int}"
@using System.Text.Json
@using System.Text
@using System.Net.Http.Headers

@inject NavigationManager NavigationManager

@inject HttpClient Http

<div class="page">
    <AuthorizeView>
        <Authorized Context="Auth">
            @if (user == null)
            {
                <p>Wczytywanie...</p>
            }
            else
            {
                <div class="border">
                    <div class="left">
                        <h3>Awatar</h3>
                        @if (user.ProfilePicture != "")
                        {
                            <div>
                                <img class="avatar-img" src="@user.ProfilePicture"/>
                            </div>
                              

                        }
                    </div>
                    <div class="right" style="">
                        <h3>Dane konta</h3>
                        <h6>Imię </h6>
                        <div class="form-row form-control" style="padding:5px;">
                            <label>@user.Name</label>
                        </div>

                        <h6>Nazwisko </h6>
                        <div class="form-row form-control" style="padding: 5px;">
                            <label>@user.Surname</label>
                        </div>

                        <h6>E-Mail </h6>
                        <div class="form-row form-control" style="padding: 5px;">
                            <label>@user.Email</label>
                        </div>

                        <h6>Numer Telefonu </h6>
                        <div class="form-row form-control" style="padding: 5px;">
                            <label>@user.PhoneNumber</label>
                        </div>  
                        <br>
                        <h6 class="info">Konto założone dnia: @user.RegistrationDate</h6>
                        
                    </div> 
                </div>
                <br/><br/>
                
                    <div class="panel-full">
                        @foreach (var item in user.UserTours)
                        {

                            <div class="background" @onclick="() => GoToDetails(item.Id)">
                                <div class="centered">@item.TourName</div>
                                @if (item.MainPhoto != "")
                                {

                                    <img src="@item.MainPhoto" style="width:100%;height:100%; background-position:center; background-size:cover;" />

                                }
                            </div>
                        }
                    </div>
                
                    
            }
        </Authorized>
        <NotAuthorized>
            <p>Nie można wyświetlić strony niezalogowanym użytkownikom</p>
        </NotAuthorized>
    </AuthorizeView>
</div>
@code {
    [Parameter]
    public int Id { get; set; }
    private UserInformationVm user;


    protected override async Task OnInitializedAsync()
    {
        user = await Http.GetFromJsonAsync<UserInformationVm>($"api/users/GetOtherUserInformation/{Id}");
        user.UserTours.Reverse();
    }

    public void GoToDetails(int id)
    {
        NavigationManager.NavigateTo($"/tours/{id}");
    }
}

